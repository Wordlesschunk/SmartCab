{% extends 'base.html.twig' %}

{% block title %}Item index{% endblock %}

{% block body %}

    <style>
        #example td, #example th {
            vertical-align: middle;
            white-space: nowrap;
        }

        .item-image {
            width: 48px;
            height: 48px;
            object-fit: contain;
            border-radius: 6px;
            background: #f8f9fa;
            padding: 4px;
        }

        .min-w-75 { min-width: 75px; }

        #example thead th {
            background: #f8f9fa;
            font-weight: 600;
        }
    </style>

    {# Top toolbar #}
    <div class="d-flex justify-content-between align-items-center mb-3 mt-3">
        <div class="input-group" style="max-width: 520px;">
{#            <span class="input-group-text">#}
{#                <i class="fa fa-search"></i>#}
{#            </span>#}
            <input id="table-search" type="text" class="form-control" placeholder="Search inventory...">
        </div>

        <a href="{{ path('app_item_new') }}" class="btn btn-primary">
            <i class="fa fa-plus"></i> Create
        </a>
    </div>

    <table id="example" class="display" style="width:100%">
        <thead>
        <tr>
            <th>Id</th>
            <th>Image</th>
            <th>Item</th>
            <th>Quantity</th>
            <th>Location</th>
            <th>Actions</th>
        </tr>
        </thead>

        <tbody>
        {% for item in items %}
            <tr class="{{ item.quantity < 5 ? 'table-warning' : '' }}">
                <td>{{ item.id }}</td>

                <td>
                    <img src="https://media.rs-online.com/F7976222-01.jpg" class="item-image" alt="Item image">
                </td>

                <td>
                    <twig:InlineEditItemName :item="item" />
                </td>

                <td class="text-center">
                    <div class="d-inline-block min-w-75">
                        <twig:InlineEditItemQuantity :item="item" />
                    </div>
                </td>

                <td>
                    <twig:InlineEditItemDrawer :item="item" />
                </td>

                <td class="actions-btns">
{#                    <a href="{{ path('app_item_show', {'id': item.id}) }}" class="btn btn-sm btn-primary">#}
{#                        Show#}
{#                    </a>#}
{#                    <a href="{{ path('app_item_edit', {'id': item.id}) }}" class="btn btn-sm btn-secondary">#}
{#                        Edit#}
{#                    </a>#}

                    <form method="post" action="{{ path('app_item_delete', {'id': item.id}) }}" onsubmit="return confirm('Are you sure you want to delete this item?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ item.id) }}">
                        <button class="btn btn-sm btn-danger">Delete</button>
                    </form>

                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <script>
        $(document).ready(function () {
            let table = $('#example').DataTable({
                paging: false,
                columnDefs: [
                    { orderable: false, targets: [1, 5] } // image + actions not sortable
                ],
                dom: 't' // hide built-in search - we use our own input
            });

            $('#table-search').on('keyup', function () {
                table.search(this.value).draw();
            });
        });
    </script>

{% endblock %}
